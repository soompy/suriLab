exports.id=628,exports.ids=[628],exports.modules={31183:(t,e,r)=>{"use strict";r.d(e,{z:()=>s});var a=r(96330);let s=globalThis.prisma??new a.PrismaClient({log:["query","info","warn","error"]})},52240:(t,e,r)=>{"use strict";r.d(e,{EX:()=>D,Rr:()=>q,iy:()=>N,N7:()=>I});var a=r(32190);class s{constructor(t){this.prisma=t}async findAll(t,e,r){let a={};if(t){if(t.category&&(a.category={name:t.category}),t.tags&&t.tags.length>0&&(a.tags={some:{name:{in:t.tags}}}),t.authorId&&(a.authorId=t.authorId),t.searchQuery){let e=t.searchQuery.toLowerCase();a.OR=[{title:{contains:e,mode:"insensitive"}},{excerpt:{contains:e,mode:"insensitive"}},{content:{contains:e,mode:"insensitive"}},{tags:{some:{name:{contains:e,mode:"insensitive"}}}}]}void 0!==t.featured&&(a.featured=t.featured),void 0!==t.isPublished&&(a.isPublished=t.isPublished)}let s={};e?s[e.field]=e.order:s.publishedAt="desc";let i=r?.page||1,o=r?.limit||10,[n,c]=await Promise.all([this.prisma.post.findMany({where:a,orderBy:s,skip:(i-1)*o,take:o,include:{tags:!0,category:!0,author:!0}}),this.prisma.post.count({where:a})]);return{posts:n.map(this.mapToEntity),total:c,page:i,totalPages:Math.ceil(c/o)}}async findById(t){let e=await this.prisma.post.findUnique({where:{id:t},include:{tags:!0,category:!0,author:!0}});return e?this.mapToEntity(e):null}async findBySlug(t){let e=await this.prisma.post.findUnique({where:{slug:t},include:{tags:!0,category:!0,author:!0}});return e?this.mapToEntity(e):null}async create(t){let e=await this.prisma.category.upsert({where:{name:t.category},update:{},create:{name:t.category}}),r=await this.prisma.user.upsert({where:{id:t.authorId},update:{},create:{id:t.authorId,name:"Blog Author",email:"author@example.com"}}),a=await this.prisma.post.create({data:{title:t.title,content:t.content,excerpt:t.excerpt,slug:t.slug,featured:t.featured||!1,isPublished:t.isPublished||!1,readTime:Math.ceil(t.content.split(" ").length/200),categoryId:e.id,authorId:r.id,tags:{connectOrCreate:t.tags.map(t=>({where:{name:t},create:{name:t}}))}},include:{tags:!0,category:!0,author:!0}});return this.mapToEntity(a)}async update(t){let e={};t.title&&(e.title=t.title),t.content&&(e.content=t.content,e.readTime=Math.ceil(t.content.split(" ").length/200)),t.excerpt&&(e.excerpt=t.excerpt),t.slug&&(e.slug=t.slug),void 0!==t.featured&&(e.featured=t.featured),void 0!==t.isPublished&&(e.isPublished=t.isPublished),t.category&&(e.categoryId=(await this.prisma.category.upsert({where:{name:t.category},update:{},create:{name:t.category}})).id),t.tags&&(e.tags={set:[],connectOrCreate:t.tags.map(t=>({where:{name:t},create:{name:t}}))});let r=await this.prisma.post.update({where:{id:t.id},data:e,include:{tags:!0,category:!0,author:!0}});return this.mapToEntity(r)}async delete(t){await this.prisma.post.delete({where:{id:t}})}async incrementViews(t){await this.prisma.post.update({where:{id:t},data:{views:{increment:1}}})}async getCategories(){return(await this.prisma.category.findMany({select:{name:!0}})).map(t=>t.name)}async getTags(){return(await this.prisma.tag.findMany({select:{name:!0}})).map(t=>t.name)}async getStats(){let[t,e,r,a]=await Promise.all([this.prisma.post.count(),this.prisma.post.aggregate({_sum:{views:!0}}),this.prisma.category.count(),this.prisma.tag.count()]);return{totalPosts:t,totalViews:e._sum.views||0,totalCategories:r,totalTags:a}}mapToEntity(t){return{id:t.id,title:t.title,content:t.content,excerpt:t.excerpt,slug:t.slug,publishedAt:t.publishedAt,updatedAt:t.updatedAt,tags:t.tags.map(t=>t.name),category:t.category.name,authorId:t.authorId,readTime:t.readTime,views:t.views,featured:t.featured,isPublished:t.isPublished}}}class i{constructor(t){this.postRepository=t}async execute(t,e,r){return await this.postRepository.findAll(t,e||{field:"publishedAt",order:"desc"},r||{page:1,limit:10})}}class o{constructor(t){this.postRepository=t}async execute(t){let e=await this.postRepository.findById(t);return e&&await this.postRepository.incrementViews(t),e}}class n{constructor(t){this.postRepository=t}async execute(t){let e=await this.postRepository.findBySlug(t);return e&&await this.postRepository.incrementViews(e.id),e}}class c{constructor(t){this.postRepository=t}async execute(){let[t,e,r]=await Promise.all([this.postRepository.getStats(),this.postRepository.getCategories(),this.postRepository.getTags()]);return{...t,categories:e,tags:r}}}class u{constructor(t){this.postRepository=t}async execute(t){if(this.validateInput(t),await this.postRepository.findBySlug(t.slug))throw Error("Post with this slug already exists");return await this.postRepository.create(t)}validateInput(t){if(!t.title.trim())throw Error("Title is required");if(!t.content.trim())throw Error("Content is required");if(!t.excerpt.trim())throw Error("Excerpt is required");if(!t.slug.trim())throw Error("Slug is required");if(!t.category.trim())throw Error("Category is required");if(!t.authorId.trim())throw Error("Author ID is required");if(0===t.tags.length)throw Error("At least one tag is required");if(!/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(t.slug))throw Error("Slug must be lowercase alphanumeric with hyphens only")}}class l{constructor(t){this.postRepository=t}async execute(t){this.validateInput(t);let e=await this.postRepository.findById(t.id);if(!e)throw Error("Post not found");if(t.slug&&t.slug!==e.slug){let e=await this.postRepository.findBySlug(t.slug);if(e&&e.id!==t.id)throw Error("Post with this slug already exists")}return await this.postRepository.update(t)}validateInput(t){if(!t.id.trim())throw Error("Post ID is required");if(void 0!==t.title&&!t.title.trim())throw Error("Title cannot be empty");if(void 0!==t.content&&!t.content.trim())throw Error("Content cannot be empty");if(void 0!==t.excerpt&&!t.excerpt.trim())throw Error("Excerpt cannot be empty");if(void 0!==t.category&&!t.category.trim())throw Error("Category cannot be empty");if(void 0!==t.tags&&0===t.tags.length)throw Error("At least one tag is required");if(void 0!==t.slug&&!/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(t.slug))throw Error("Slug must be lowercase alphanumeric with hyphens only")}}class d{constructor(t){this.postRepository=t}async execute(t){if(!t.trim())throw Error("Post ID is required");if(!await this.postRepository.findById(t))throw Error("Post not found");await this.postRepository.delete(t)}}var p=r(31183);async function h(){try{await p.z.$connect(),console.log("Database connected successfully");let t=process.env.DATABASE_URL||"";console.log(`Database URL: ${t.substring(0,30)}...`),await g(),console.log("Database initialization completed")}catch(t){console.error("Database initialization failed:",t),console.log("Continuing without database initialization...")}}async function g(){try{await p.z.user.findFirst({where:{email:"yzsumin@naver.com"}})||(await p.z.user.create({data:{id:"admin-user-id",name:"이수민",email:"yzsumin@naver.com"}}),console.log("Default user created")),await p.z.category.findFirst({where:{name:"기술"}})||(await p.z.category.createMany({data:[{id:"tech",name:"기술",description:"기술 관련 포스트",color:"#3b82f6"},{id:"life",name:"일상",description:"일상 관련 포스트",color:"#10b981"},{id:"review",name:"리뷰",description:"리뷰 관련 포스트",color:"#f59e0b"}]}),console.log("Default categories created")),await p.z.tag.findFirst({where:{name:"React"}})||(await p.z.tag.createMany({data:[{name:"React"},{name:"Next.js"},{name:"TypeScript"},{name:"JavaScript"},{name:"개발"}]}),console.log("Default tags created"))}catch(t){console.error("Error creating default data:",t)}}let y=new s(p.z),w=new i(y),m=new o(y),f=new n(y),x=new c(y),E=new u(y),R=new l(y),b=new d(y);async function v(t,e,r){try{return await w.execute(t,e,r)}catch(t){throw console.error("Error getting posts:",t),t}}async function P(t){try{return await m.execute(t)}catch(t){throw console.error("Error getting post by id:",t),t}}async function I(t){try{return await f.execute(t)}catch(t){throw console.error("Error getting post by slug:",t),t}}async function T(){try{return await x.execute()}catch(t){throw console.error("Error getting blog stats:",t),t}}async function z(t){try{return await E.execute(t)}catch(t){throw console.error("Error creating post:",t),t}}async function j(t){try{return await R.execute(t)}catch(t){throw console.error("Error updating post:",t),t}}async function A(t){try{return await b.execute(t)}catch(t){throw console.error("Error deleting post:",t),t}}class N{static async GET(t){try{let{searchParams:e}=new URL(t.url),r=e.get("category")||void 0,s=e.get("tags")?.split(",")||void 0,i=e.get("authorId")||void 0,o=e.get("search")||void 0,n="true"===e.get("featured")||void 0,c="false"!==e.get("isPublished")||"false"!==e.get("isPublished")&&void 0,u=e.get("sortField")||"publishedAt",l=e.get("sortOrder")||"desc",d=parseInt(e.get("page")||"1"),p=parseInt(e.get("limit")||"10"),h=await v({category:r,tags:s,authorId:i,searchQuery:o,featured:n,isPublished:c},{field:u,order:l},{page:d,limit:p});return a.NextResponse.json(h)}catch{return a.NextResponse.json({error:"Failed to fetch posts"},{status:500})}}static async POST(t){try{let e=await t.json();console.log("Creating post with data:",e);try{await h()}catch(t){console.warn("Database initialization failed, continuing...",t)}let r=await z(e);return console.log("Post created successfully:",r),a.NextResponse.json(r,{status:201})}catch(t){return console.error("Error creating post:",t),a.NextResponse.json({error:"Failed to create post",details:t instanceof Error?t.message:"Unknown error"},{status:500})}}}class q{static async GET(t,{params:e}){try{let t=await P(e.id);if(!t)return a.NextResponse.json({error:"Post not found"},{status:404});return a.NextResponse.json(t)}catch{return a.NextResponse.json({error:"Failed to fetch post"},{status:500})}}static async PUT(t,{params:e}){try{let r=await t.json(),s={id:e.id,...r},i=await j(s);return a.NextResponse.json(i)}catch{return a.NextResponse.json({error:"Failed to update post"},{status:400})}}static async DELETE(t,{params:e}){try{return await A(e.id),a.NextResponse.json({success:!0})}catch{return a.NextResponse.json({error:"Failed to delete post"},{status:400})}}}class D{static async GET(){try{let t=await T();return a.NextResponse.json(t)}catch{return a.NextResponse.json({error:"Failed to fetch blog stats"},{status:500})}}}},78335:()=>{},96487:()=>{}};